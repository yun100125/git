<!DOCTYPE html>

<html>

<head>
<style>

	#info {
	  position: absolute;
	  top: 2%;
	  width: 100%;
	  padding: 10px;
	  text-align: center;
	  color: #ffff00
	}

	body {
	  overflow: hidden;
	}

</style>
</head>

<body> 
	<div id="info">HW1
	  <br/>I3A04吳佳芸<br/>
	  <button id="toggle" style="width:20%">Toggle Turn</button>
	  <button id="analog" style="width:20%">Analog</button>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r78/three.min.js"></script>
	<script src="https://threejs.org/examples/js/controls/OrbitControls.js">


	</script>
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

<script>
var controls, scene, renderer, camera;
var hue = 0, count = 1;
var clock=new THREE.Clock();
var bt2 = 0, turn = false;
var sec,bgIn,bgOut, angle,angleNow=0,startTime,sechand2,sechand1,show;
  
init();
animate();

$("#toggle").click(function() {
  turn = !turn;
  if(turn){
  	startTime=clock.getElapsedTime();
  }
  else{
  	angleNow=angle;
  }
});

$("#analog").click(function() {
  if(bt2==0){
    $("#analog").text("Quartz");
    bt2=1;
  }
  else if(bt2==1){
  	$("#analog").text("Sector");
    bt2=2;
  }
  else{
  	$("#analog").text("Analog");
  	bt2=0;
  }
});

function init() {
  scene = new THREE.Scene();
  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setClearColor(0x104440);
  document.body.appendChild(renderer.domElement);
	
  camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
  camera.position.z = 500;
  controls = new THREE.OrbitControls(camera, renderer.domElement);
  
  //底(時鐘)
  show=new THREE.Object3D();
	var geometry = new THREE.RingGeometry(0.5, 150, 32);
  var material = new THREE.MeshBasicMaterial({
    color: 0x000000,
    side: THREE.DoubleSide
  });
  sec = new THREE.Mesh(geometry, material);
  scene.add(sec);
  
  //指針
  var sh = new THREE.BoxGeometry( 5, 100, 10 );
	var shh = new THREE.MeshBasicMaterial( {color: 'white'} );
	sechand1 = new THREE.Mesh( sh, shh );
  sechand1.position.y=50;
	var tri = new THREE.CylinderGeometry( 0, 10, 55, 32 );
	var trii = new THREE.MeshBasicMaterial( {color: 'white'} );
	sechand2 = new THREE.Mesh( tri, trii );
  sechand2.position.y=105;
  show.add(sechand2);
	show.add( sechand1 );
  
  //底(扇形)
  geometry = new THREE.RingGeometry(0.5, 150, 50);
  material = new THREE.MeshBasicMaterial({
    color: 'black',
    side: THREE.DoubleSide
  });
  bgIn = new THREE.Mesh(geometry, material);
  bgIn.material.visible=false;
  scene.add(bgIn);
	
  //框
  geometry = new THREE.RingGeometry(150, 155, 50);
  material = new THREE.MeshBasicMaterial({
    color: 'white',
    side: THREE.DoubleSide
  });
  bgOut = new THREE.Mesh(geometry, material);
  bgOut.material.visible=false;
  scene.add(bgOut);
  show.rotation.y=Math.PI;
  scene.add(show);

  
  var gridXZ = new THREE.GridHelper(100, 10, 'red', 'white');
 // scene.add(gridXZ);
  window.addEventListener('resize', onWindowResize, false);
}

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
	
	angle = angle||0;
  controls.update();
  if (turn) {
      var move =clock.getElapsedTime()-startTime;
      angle=angleNow+move;
      //console.log(angle);
      count%=59;
      angle%=60;
  }
  
  if(bt2==0){
      show.visible=true;
      show.rotation.z=angle*Math.PI/30;
      sec.material.visible=false;
  	bgIn.material.visible=true;
    bgOut.material.visible=true;
  }
  else if(bt2==1){
     show.visible=true;
     console.log(count);
     console.log(angle);
     if(angle-count>=0){
      show.rotation.z=angle*Math.PI/30;
      count++;
   	}
    sec.material.visible=false;
  	bgIn.material.visible=true;
    bgOut.material.visible=true;
  }
  else{
    show.visible=false;
    sec.rotation.y=Math.PI;
    sec.geometry = new THREE.RingGeometry (0.5, 150, 32, 2, Math.PI/2, angle*Math.PI/30);
    sec.material.visible=true;
  	bgIn.material.visible=false;
  }
  
  // mesh.material.color.setHSL (hue, hue, .8)
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}

</script>
</body>

</html>
